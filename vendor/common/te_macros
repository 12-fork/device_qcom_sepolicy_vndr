########################################
## peripheral_manager
## Allow clients to interact with peripheral
## manager
define(`use_per_mgr', `
    vndbinder_use($1);
    binder_call(per_mgr, $1);
    binder_call($1, per_mgr);
    allow $1 per_mgr_service:service_manager find;
    get_prop($1, per_mgr_state_prop);
')

#####################################
## use_netutils(clientdomain)
## allow access to netutils from vendor
define(`use_netutils', `
    domain_auto_trans($1, netutils_wrapper_exec, netutils_wrapper)
    allow netutils_wrapper $1:fd use;
    allow netutils_wrapper $1:fifo_file { read write getattr };
    allow netutils_wrapper $1:netlink_route_socket { read write };
    allow netutils_wrapper $1:unix_stream_socket { read write };
    allow netutils_wrapper $1:netlink_generic_socket { read write };
    allow netutils_wrapper $1:netlink_xfrm_socket { read write };
    allow netutils_wrapper $1:udp_socket { read write };
    allow netutils_wrapper $1:tcp_socket { read write };
')

#####################################
## hal_server_domain_bypass(domain, hal_type)
## Allow a base set of permissions required for a domain to offer a
## HAL implementation of the specified type over HwBinder without
## halserverdomain attribute
##
## For example, default implementation of Foo HAL:
##   type hal_foo_default, domain;
##   hal_server_domain_bypass(hal_foo_default, hal_foo)
##
define(`hal_server_domain_bypass', `
    hwbinder_use($1)
    allow $1 system_file:dir r_dir_perms;
    get_prop($1, hwservicemanager_prop)
    typeattribute $1 $2_server;
    typeattribute $1 $2;
')

#####################################
## diag_use(clientdomain)
## allow clientdomain to read/write to diag
define(`diag_use', `
    r_dir_file($1, sysfs_diag)
    allow $1 diag_device:chr_file rw_file_perms;
')
